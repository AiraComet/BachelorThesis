\documentclass[11pt,a4paper]{article}
\usepackage[show]{ed}
\usepackage{tikz}
\usepackage{hyperref}


\title{Building Mathhub using React\\ \vspace{2 mm} Bachelor Thesis}
\author{Johannes-Sebastian See\\Supervisor: Michael Kohlhase\\Co-supervisor: Tom Wiesing\\Friedrich-Alexander University, Erlangen NÃ¼rnberg, Germany}

\date{\today}

\begin{document}

\begin{titlepage}
\maketitle
\end{titlepage}

\tableofcontents
\section{Introduction}
	\subsection{Mathhub}
	\subsection{Drupal Attack}
	Up until April 2018 Mathhub was build with Drupal. Drupal is an open source content-management framework used by millions of different websites.
	But in April 2018 a critical security flaw in the versions 6 to 8 went public. The problem was that the Drupal core in these versions accepts request parameters without any validation. This means the core processes any input from anybody. To exploit this weakness an attacker doesn't even need to log in or have any other privileges on a vulnerable website. With this flaw it is possible to inject malicious code and compromise a website in multiple ways. This can be used to access, change and delete private data and create backdoors to make future attacks possible. The Drupal community called this weakness "Drupalgeddon2" while its official name was "CVE-2018-7600". Some code that was injected installed the program XMRig Monero miner, which is a cryptocurrency mining program, as well as deleting other mining programs on the compromised system. The National Institute of Standards (NIST) and Technology gave Drupal a "Highly Critical" Rating because of this vulnerability. After this flaw was discovered a patch was published and a warning to update every website that used a vulnerable version was given.
	
Since this was not the first detected flaw in Drupal the decision to stop using it and rebuild Mathhub from the ground up to not be affected by future attacks was made.

	\subsection{Building an interactive Frontend - State of the art}

\section{React}
	\subsection{Core concept}
	\subsection{Building new components}

\section{The Architecture of Mathhub}

\providecommand\myxscale{.95}
\providecommand\myyscale{1}
\begin{tikzpicture}[xscale=\myxscale,yscale=\myyscale]
  \tikzstyle{system} = [rectangle, draw, fill=blue!20, text width=1cm, text centered,
                                    rounded corners, minimum height=.8cm,shade, 
                                    top color=white, bottom color=blue!20]
   \tikzstyle{database} = [rectangle, draw, fill=blue!20, text width=1cm, text centered,
                                    rounded corners, minimum height=.8cm,shade, 
                                    top color=white, bottom color=blue!20]
\node (user) {user}; 
\node[system,right of =user,text width=2cm, xshift=3cm] (browser) {Browser}; 
\node[system,right of= browser,text width=2.3cm, xshift=2.6cm] (drupal) {React};
\node[system,above right of =drupal, xshift = 2.8cm] (mmt) {MMT};
\node[system,below right of =drupal, xshift = 2.8cm, text width=1.2cm] (gl) {GitLab};
\node[database,below left of =gl, yshift = -0.6cm, xshift = -3cm] (lib) {library};
\node[below right of =gl, yshift = -0.6cm, xshift = 1.6cm] (author) {author}; 
\node[below right of =mmt, yshift =0.7cm,  xshift = 1.6cm] (conv) {\begin{tabular}{l}\footnotesize convert to\\ OMDoc\\/MMT\end{tabular}};
\draw[<-,thick] (mmt) -- node[left]{load} (gl);
\draw[<->,dotted] (user) -- node[above]{read} node[below]{interact} (browser);
\draw[->,thick] (browser) -- node[above]{REST} (drupal);
\draw[->,thick] (gl) to[loop left,out=20,in=45,looseness=11] (gl); 
\draw[<->,dashed] (conv) -- (mmt);
\draw[<-,thick] (drupal) -- node[above]{present}(mmt); 
\draw[->,thick] (drupal) -- node[above]{edit}(gl); 
\draw[->,dotted] (author) -- node[above]{local} node[below]{edit} (gl);
\draw[->,dotted] (lib) -- node[below]{import} (gl);
\end{tikzpicture}
\ednote{look for author and user pictures}

\subsection{Mathhub Routes}
\begin{tikzpicture}[xscale=\myxscale, yscale=\myyscale]
  \tikzstyle{component} = [rectangle, draw, fill=blue!20, text width=2cm, text centered,
                                    rounded corners, minimum height=.8cm,shade, 
                                    top color=white, bottom color=blue!20]
\node[component] (MH) {Mathhub};
\node[component, below of =MH, xshift=-1.2cm, yshift=-0.7cm] (lib) {Library};
\node[component, below of =lib, yshift=-0.7cm] (groups) {Groups};
\node[component, below of =groups, yshift=-0.7cm] (archives) {Archives};
\node[component, below of =archives, text width=5cm, text height=1.8cm, yshift=-1.3cm, label ={[shift={(0ex,-4ex)}]north:Modules}] (mod) {};
\node[component, below left of =mod, xshift=-0.5cm, yshift=0.5cm] (theo) {Theories};
\node[component, below right of =mod, text width=1.5cm, xshift=0.5cm, yshift=0.5cm] (views) {Views};
\node[component, below of=mod, yshift=-1.2cm] (decl) {Declarations};
\node[component, below left of =MH, xshift = -4.3cm, yshift=-0.7cm] (apps) {Applications};
\node[component, below left of =apps, xshift=-0.5cm, yshift=-0.7cm] (glos) {Glossary};
\node[component, below right of =apps, xshift=0.5cm, yshift=-0.7cm] (dict) {Math Dictionary};
\node[component, below of=MH, xshift=1.6cm, yshift=-0.7cm] (news) {News};
\node[component, below right of=MH, xshift=3.7cm, yshift=-0.7cm] (legal) {Legal};
\draw[->,dotted] (MH) -- node[above]{} (lib);
\draw[->,dotted] (MH) -- node[above]{} (apps);
\draw[->,dotted] (MH) -- node[above]{} (news);
\draw[->,dotted] (MH) -- node[above]{} (legal);
\draw[->,thick] (lib) -- node[above]{} (groups);
\draw[->, thick] (groups) -- node[above]{} (archives);
\draw[->,thick] (archives) -- node[above]{} (mod);
\draw [->,thick] (mod) -- node[above]{} (decl);
\draw[->,thick] (apps) -- node[above]{} (glos);
\draw[->,thick] (apps) -- node[above]{} (dict);
\end{tikzpicture}

Routes are used to navigate through the many different uses of Mathhub. Every application and every component has its own route. At the top of the Mathhub frontend there is a menu which contains the links to home under "Mathhub". The math dictionary and the glossary can be accessed through the dropdown menu "Applications". The "News" tab has the route to the news. The dropdown menu "Help" has three external links "Documentation", which leads to the the "Mathhub Documentation wiki" on github.com, "Browse Sources", where the different project of the KWARC group can be found and "Contact a Human" to write an E-Mail to the KWARC staff. To learn more about Mathhub itself the tab "About" links to "About Mathhub.info" in the Mathhub wiki.

At the bottom of the frontend the routes to the Imprint, Privacy Policy and Licenses can be found.

The most interesting part are the library routes. Every step in the library hierarchy is its own route. Starting with the different groups to their archives with their modules, which can be either theories or views. 
\subsection{Mathhub Library API}
The library is build with IApiObjectItems. An IApiObjectItem consists of an ID, a name, a parent if one exists and statistics if available. Further attributes are dependent on its kind. The possible kinds are group, archive, document, opaque, module, declaration, component and tag. \ednote{What's up with Theory and View?} Since most objects have many children it would be unnecessary to load every information for every child at once. To reduce the cost for loading a page there exists a smaller version of every object called a reference. These reference objects only have the necessary information like ID, name, parent, statistics and in some cases a short teaser of the content. For example when a group is opened it only loads a list of references to the archives contained in this group instead of the complete archives.

\section{Mathhub Components}
	\subsection{Libraries}
	\subsection{Archives}
	\subsection{Modules: Theories and Views}
	\subsection{Statistics}

\section{The Applications of Mathhub}
	\subsection{Glossary}
	\subsection{Math Dictionary}

\section{Communication with the backend}

\section{Conclusion}
Don't forget Notes
\ednote{I am a Note}

\section{Future Work}
	\subsection{TGView}
	\subsection{MathWebSearch}
	\subsection{Subset Frontends}
	\subsection{Issue report: Mathhub and content}

\section{Sources}
Drupal Attack:
\begin{itemize}
\item \url{https://nvd.nist.gov/view/vuln/search-results?cpe=cpe%3A%2Fa%3Adrupal%3Adrupal%3A7.38&page_num=0&cid=3}
\item \url{https://www.theregister.co.uk/2018/03/28/drupal_urgent_security_software_patch/}
\item \url{https://www.zdnet.com/article/update-drupal-asap-over-a-million-sites-can-be-easily-hacked-by-any-visitor/}
\item \url{https://thehackernews.com/2018/04/drupal-cryptocurrency-hacking.html}
\item \url{https://thehackernews.com/2018/04/drupal-site-vulnerability.html}
\end{itemize}
\end{document}